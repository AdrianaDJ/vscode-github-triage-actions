# Deep Classifier

The deep classifier workflow is comprised of many parts:

- Shared
  - Azure Storage account
    - This is used to store the models and issue data
- Training
  - ./train/fetch-issues Action
    - This Action scrapes issues from the repo and uploads them to issues.json.zip in blob storage.
  - Azure GPU VM
    - A GPU-enabled VM running Ubuntu is needed to train the models. The ./vm-filesystem directory contains the files needed in the VM.
    - The provision-vm.sh script has been tested to work with NC6s_v2 VM's on Azure.
- Applying
  - ./apply/fetch-sources Action
    - This pulls the recent issues, models and other related daata from blob storage and places them on the Action runner's filesystem for
  - ./apply/generaate-labels Action
    - This runs the downloaaded models against the recent issues and stores the results on the filesystem
  - ./apply/apply-labels
    - This takes the labelings generated by the generate stage and pushes them to GitHub.


## One-Time Setup
1. Create an Azure Storage account for storing models, issue data, etc.
1. Run the fetch-issues action to scrape issue data and place it into blob storage
2. Create an GPU-powered Azure VM (tested to work with NC6s_v2 models). Setting an auto-shutoff time is a good idea to prevent accidental cost overruns. The chief expense is actually storage - but this can be dramatically reduced by specifying a 32GB HDD as the OS disk. The 32GB dish leaves room for models, but be sure to reduce the number of "checkpoints" saved to save space.
3. On the VM, run the provision-vm.sh script to download all drivers/etc
4. On the VM, update the run.sh script to use your blob container name, and update storage.ts to use your connection string.
5. On the VM, Run the download script to get the issues.json.zip dump, decompress it and run createFineTunedModel to create a the initial model. This will take a while.
6. On the VM, run the ./run.sh script to generate and upload models. This will take a while.


## Periodic Re-Training
2. On the VM, run the ./run.sh script to generate and upload models. This will take a while.